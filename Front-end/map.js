var cdlist = {
    'Aranda': [-35.258333, 149.08],
    'Belconnen': [-35.2218989, 149.0353134],
    'Hume': [-35.387, 149.17],
    'Lawson': [-35.225, 149.088056],
    'Bruce': [-35.242, 149.077],
    'Charnwood': [-35.2, 149.037],
    'Cook': [-35.259722, 149.063889],
    'Kowen': [-35.3126627, 149.3171038],
    'Dunlop': [-35.195556, 149.02],
    'Molonglo': [-35.299828, 149.040199],
    'Evatt': [-35.211667, 149.067778],
    'Florey': [-35.225833, 149.049444],
    'Flynn': [-35.2025, 149.050278],
    'Fraser': [-35.1925, 149.050556],
    'Giralang': [-35.211944, 149.097222],
    'Acton': [-35.279444, 149.119444],
    'Gooromon': [-35.170273, 149.015201],
    'Hawker': [-35.244, 149.038],
    'Higgins': [-35.232222, 149.027222],
    'Majura': [-35.2736652, 149.2190324],
    'Holt': [-35.22416700000001, 149.015278],
    'Kaleen': [-35.221, 149.106],
    'Latham': [-35.217222, 149.031389],
    'Macgregor': [-35.210833, 149.015278],
    'Macquarie': [-35.250833, 149.064722],
    'McKellar': [-35.2175, 149.076111],
    'Melba': [-35.208333, 149.054167],
    'Hall': [-35.1679431, 149.0616656],
    'Page': [-35.4734679, 149.0123679],
    'Scullin': [-35.234722, 149.038333],
    'Spence': [-35.198889, 149.065278],
    'Weetangera': [-35.25, 149.049],
    'ACTSouthWest': [-35.4734679, 149.0123679],
    'Namadgi': [-35.6322068, 148.8747865],
    'ACTEast': [-35.4734679, 149.0123679],
    'Mitchell': [-35.215278, 149.140833],
    'Amaroo': [-35.171389, 149.128889],
    'Bonner': [-35.16413, 149.13322],
    'Casey': [-35.1747, 149.0959],
    'Crace': [-35.2048561, 149.1070459],
    'Forde': [-35.166389, 149.143056],
    'Franklin': [-35.2, 149.1425],
    'GungahlinTC': [-35.4734679, 149.0123679],
    'GungahlinEast': [-35.4734679, 149.0123679],
    'GungahlinWest': [-35.4734679, 149.0123679],
    'Harrison': [-35.1975, 149.154444],
    'Ngunnawal': [-35.175833, 149.109167],
    'Nicholls': [-35.186, 149.092],
    'Palmerston': [-35.19457, 149.114],
    'LakeBurleyGriffin': [-35.2951212, 149.1142215],
    'Ainslie': [-35.262778, 149.144167],
    'Braddon': [-35.271944, 149.135556],
    'Campbell': [-35.288056, 149.153889],
    'Civic': [-35.4734679, 149.0123679],
    'Dickson': [-35.2525, 149.139722],
    'Downer': [-35.244167, 149.145],
    'Hackett': [-35.248056, 149.162778],
    'Parkes': [-35.3, 149.133333],
    'Lyneham': [-35.25, 149.129167],
    "O'Connor": [-35.259167, 149.121111],
    'Reid': [-35.283333, 149.141667],
    'Turner': [-35.268611, 149.124167],
    'Watson': [-35.238333, 149.153333],
    'Deakin': [-35.316, 149.107],
    'Forrest': [-35.318056, 149.125],
    'Griffith': [-35.32472200000001, 149.137222],
    'Kingston-Barton': [-35.307778, 149.134444],
    'Narrabundah': [-35.3325, 149.153333],
    'RedHill': [-35.33397290000001, 149.124268],
    'Yarralumla': [-35.305092, 149.098098],
    'Banks': [-35.4734679, 149.0123679],
    'Bonython': [-35.431, 149.082],
    'Calwell': [-35.438, 149.11],
    'Chisholm': [-35.424167, 149.1225],
    'Conder': [-35.458, 149.097],
    'Fadden': [-35.402, 149.118],
    'Gilmore': [-35.421, 149.133],
    'Gordon': [-35.451, 149.085],
    'Gowrie': [-35.412, 149.11],
    'Greenway': [-35.41800000000001, 149.07],
    'IsabellaPlains': [-35.428, 149.095],
    'Kambah': [-35.394444, 149.068611],
    'Macarthur': [-35.405833, 149.13],
    'Monash': [-35.417, 149.1],
    'MountTaylor': [-35.4734679, 149.0123679],
    'Oxley': [-35.40600000000001, 149.08],
    'Richardson': [-35.4300126, 149.1127863],
    'Theodore': [-35.446, 149.122],
    'Tuggeranong': [-35.4244, 149.0888],
    'Wanniassa': [-35.403056, 149.097222],
    'Chapman': [-35.35700000000001, 149.04],
    'Duffy': [-35.337, 149.035],
    'Fisher': [-35.361, 149.057],
    'Holder': [-35.336, 149.045],
    'Rivett': [-35.348, 149.038],
    'Stirling': [-35.349, 149.05],
    'Waramanga': [-35.353, 149.063],
    'Weston': [-35.338, 149.059],
    'Chifley': [-35.351111, 149.077778],
    'Curtin': [-35.325, 149.077778],
    'Farrer': [-35.377222, 149.105278],
    'Garran': [-35.342, 149.108],
    'Hughes': [-35.333, 149.094],
    'Isaacs': [-35.3675, 149.111389],
    'Lyons': [-35.342, 149.076],
    'Mawson': [-35.3653069, 149.0947898],
    "O'Malley": [-35.3525, 149.108611],
    'Pearce': [-35.362, 149.085],
    'Phillip': [-35.349444, 149.090278],
    'Torrens': [-35.372778, 149.087222]
};

var markers = [];
var circles = [];

var globelMap;
function initMap() {
    var canberra = { lat: -35.281, lng: 149.120 };

    var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 10,
        center: canberra
    });

    globelMap = map;
    var kmlLayer = new google.maps.KmlLayer({
        url: 'https://opendata.arcgis.com/datasets/565b5afe76914aeaa3463bd42714a4d6_1.kml?outSR=%7B%22wkid%22%3A28355%2C%22latestWkid%22%3A28355%7D',
        suppressInfoWindows: true,
        map: map
    });
}

function addMarker(loc, map, data) {
    loc = cdlist[loc];
    var marker = new google.maps.Marker({
        position: new google.maps.LatLng(loc[0], loc[1]),
        label: data,
        map: map
    });
    markers.push(marker);
}

function clear(flag) {
    if(flag == 'marker'){
        for (var i = 0; i < markers.length; i++) {
            markers[i].setMap(null);
        }
    }
    else if(flag == 'circle'){
        for (var i = 0; i < circles.length; i++) {
            circles[i].setMap(null);
        }
    }
}

function drawMarkers(data) {
    clear('marker');
    var population = {'suburb':[], 'population':[]};
    for(let i=0; i < data.length; i++){
        var existing = false;
        for(let j=0; j < population.suburb.length; j++){
            if (data[i].Suburb == population.suburb[j]) {
                population.population[j] += data[i].Population;
                existing = true;
                break;
            }
        }

        if(!existing){
            population.suburb.push(data[i].Suburb);
            population.population.push(0);
        }
    }

    for(var i=0; i < population.suburb.length; i++){
        addMarker(population.suburb[i], globelMap, population.population[i].toString());
    }
}

function addCircle(loc, map, population) {
    loc = cdlist[loc];
    var circle = new google.maps.Circle({
        strokeColor: '#FF0000',
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: '#FF0000',
        fillOpacity: 0.35,
        map: map,
        center: {lat:Number(loc[0]), lng:Number(loc[1])},
        radius: Number(population) / 15
    });
    circles.push(circle);
}

function drawCircle(data, flag) {
    clear('circle');

    if (flag == 'population'){
        var population = {'suburb':[], 'population':[]};
        for(let i=0; i < data.length; i++){
            var existing = false;
            for(let j=0; j < population.suburb.length; j++){
                if (data[i].Suburb == population.suburb[j]) {
                    population.population[j] += data[i].Population;
                    existing = true;
                    break;
                }
            }

            if(!existing){
                population.suburb.push(data[i].Suburb);
                population.population.push(0);
            }
        }

        for(var i=0; i < population.suburb.length; i++){
            addCircle(population.suburb[i], globelMap, population.population[i].toString());
        }
    }

    else if (flag == 'crash'){
    }
}