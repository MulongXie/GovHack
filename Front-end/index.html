<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" type="text/css" href="index.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="map.js"></script>
    <script src="plot.js"></script>
</head>
<body>

<div class="nav">
    <ul>
        <li><a onclick="initCategorize('population')"><span>Population</span></a></li>
        <li><a onclick="initCategorize('employment')"><span>Employment</span></a></li>
        <li><a onclick="initCategorize('resource')"><span>Resource</span></a></li>
        <li><a onclick="initCategorize('transportation')"><span>Transportation</span></a></li>
        <li><a id="individual" onclick="initCategorize('individual')"><span>Individual Report</span></a></li>
    </ul>
</div>

<div class="content">
    <div id="btn_subpage">
        <div id="btn_pop" style="display: block;">
            <ul>
                <li><a href="http://www.4399.com"><span>Resident</span></a></li>
                <li><a href="http://www.4399.com"><span>House</span></a></li>
            </ul>
        </div>

        <div id="btn_trans" style="display: none;">
            <a href="http://www.4399.com"><span>Bus Station</span></a>
            <a href="http://www.4399.com"><span>Crash</span></a>
        </div>
    </div>
    <div class="con_left">
        <div class="title">
            <h3 id="graph_title">Population</h3>
        </div>
        <div id="plot">
        </div>
        <div class="drag_bar">
            <div class="year">
                <p id="current">2015</p>
                <input id="drag" style="width: 100%;" type="range" min="2015" max="2020" value="2015" oninput="change()">
                <p id="start">2015</p>
                <p id="end">2020</p>
            </div>
        </div>
    </div>

    <div class="con_right">
        <div id="map"></div>
    </div>

</div>

<script>
    var flag;

    function initCategorize(title){
        let g_title = document.getElementById('graph_title');
        let p_btn = document.getElementById('btn_subpage');
        let drag_bar = document.getElementById('drag');

        if (title == 'population'){
            g_title.innerText = 'Population';
            drag_bar.min = 2015;
            document.getElementById('start').innerText = '2015';
            drag_bar.max = 2020;
            document.getElementById('end').innerText = '2020';
            drag_bar.value = 2015;
            document.getElementById('current').innerText = '2015';

            p_btn.

            flag = "population";
        }
        else if (title == 'transportation'){
            g_title.innerText = 'Transportation';
            drag_bar.min = 2012;
            document.getElementById('start').innerText = '2012';
            drag_bar.max = 2019;
            document.getElementById('end').innerText = '2019';
            drag_bar.value = 2012;
            document.getElementById('current').innerText = '2012';

            flag = "crash"
        }

        query(drag_bar.min.toString(), drag_bar.value.toString(), function (data) {
            data = JSON.parse(data);
            plot(data, flag);
            // drawCircle(data, flag);
        });
    }

    function query(start, end, sendback) {
        var xhr = new XMLHttpRequest();
        xhr.open("POST", 'http://127.0.0.1:5000/' + flag, true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(JSON.stringify({
                "Year": {
                    "start": start,
                    "end": end
                }
            }
        ));
        xhr.onload = function() {
            var data = this.responseText;
            sendback(data)
        };
    }

    function change() {
        let year = document.getElementById('drag');
        let now = document.getElementById('current');

        query(year.min.toString(), year.value.toString(), function (data) {
            data = JSON.parse(data);
            plot(data, flag);
            drawCircle(data, flag);
        });
        now.innerHTML = year.value;
    }

    window.onload = function () {
        initCategorize('population');
    };

</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAN0Ca6yajDtOxs77KvF8_111e3lVrp-cs&callback=initMap"></script>
</body>
</html>